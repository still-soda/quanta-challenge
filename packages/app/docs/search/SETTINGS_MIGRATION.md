# Settings 页面迁移说明

## 概述

将独立的 WebAuthn 注册页面 (`set-authn.vue`) 迁移到统一的设置中心 (`settings`)，作为"安全设置"子页面。采用侧边栏导航设计，结构严谨，符合项目设计规范。

## 迁移内容

### 1. 新建文件结构

```
app/pages/app/settings/
├── index.vue              # 设置主页面（包含侧边栏导航）
├── index/
│   └── index.vue         # 常规设置（默认页面）
└── security.vue          # 安全设置（包含 WebAuthn 注册）
```

### 2. 设计特点

#### 整体布局

- 固定宽度 56rem（侧边栏 12rem + 间距 1.5rem + 内容区 42.5rem）
- 左侧侧边栏 + 右侧内容区的经典布局
- 侧边栏 sticky 定位，内容区可滚动

#### 侧边栏导航

- 固定宽度 12rem，sticky 定位在 top-7rem
- 大标题使用 `st-font-hero-bold`
- 导航项带边框设计，扁平精密
- 包含 4 个设置分类：
  - 常规设置 (Config)
  - 个人资料 (User) → 跳转到 `/app/space`
  - 安全设置 (Shield)
  - 高级设置 (ApplicationMenu)
- 活动项高亮：
  - 背景色 `bg-accent-500`
  - 边框色 `border-accent-400`
  - 图标为 `text-primary`
- 非活动项：
  - 边框色 `border-accent-600`
  - hover 时边框 `border-accent-500`，背景 `bg-accent-600`

#### 内容区域

- flex-1 自动填充剩余空间
- 使用 `px-[0.625rem]` 内边距
- 统一的标题结构：
  - 图标 + 标题 + 描述
  - 分割线分隔标题和内容
  - 图标大小 2xl，颜色 `text-primary`

#### 安全设置页面 (security.vue)

- 完整保留原有的 WebAuthn 注册功能
- 使用 `useRegisterAuthn` composable（无需修改）
- 严谨的结构设计：
  - 顶部标题区（图标 + 标题 + 描述）
  - 分割线
  - 表单区域（使用 StForm 和 StFormItem）
  - 按钮右对齐
  - 间距统一为 1.5rem 和 1.75rem

### 3. 向后兼容

- 保留 `set-authn.vue` 文件，但改为重定向页面
- 使用 `definePageMeta` 中间件实现 301 永久重定向
- 旧链接 `/app/set-authn` 自动跳转到 `/app/settings/security`

### 4. 路由结构

```
/app/settings              → 常规设置
/app/space                 → 个人资料（原有页面）
/app/settings/security     → 安全设置（WebAuthn）
/app/settings/advanced     → 高级设置（待实现）
/app/set-authn            → 重定向到 /app/settings/security
```

## UI/UX 改进

### 1. 一致性

- 遵循项目现有的设计系统
- 使用统一的组件（StSpace, StButton, StForm, StFormItem 等）
- 配色方案符合 accent-* 色系规范
- 字体样式使用 `st-font-*` 类
- 输入框样式使用 `outerClass` 常量
- 按钮样式与发布页面保持一致

### 2. 扁平精密

- 移除了侧边栏，改用更简洁的标签导航
- 去掉了冗余的卡片包装
- 减少了不必要的图标装饰
- 结构更加扁平，层级更少
- 间距严格遵循 1.75rem 标准

### 3. 可发现性

- 设置项集中管理，便于查找
- 标签导航清晰展示所有设置分类
- 个人资料直接跳转到已有的空间页面

### 4. 可扩展性

- 预留了其他设置项的位置
- 结构清晰，易于添加新的设置页面
- 每个设置页面独立，互不影响

## 技术细节

### 1. 保留的逻辑

- `useRegisterAuthn` composable 完全不变
- 表单验证规则保持一致
- tRPC 调用逻辑不变
- WebAuthn API 集成方式不变

### 2. 设计规范

- 容器宽度：44rem（与发布页面一致）
- 内边距：px-[0.625rem]
- 间距：1.75rem（表单项之间）
- 圆角：0.5rem（输入框）、0.375rem（按钮）
- 按钮内边距：py-[0.375rem] px-[1.25rem]

### 3. 兼容性

- 使用 Nuxt 3 的嵌套路由（`<NuxtPage />`）
- 利用 Vue Router 的动态路由匹配
- 中间件重定向确保旧链接可用

## 测试建议

1. **功能测试**
   - [ ] WebAuthn 注册流程正常工作
   - [ ] 表单验证正确触发
   - [ ] 成功/失败提示显示
   - [ ] Enter 键提交功能

2. **导航测试**
   - [ ] 标签导航切换正常
   - [ ] 活动标签高亮正确
   - [ ] 路由跳转无误
   - [ ] 个人资料跳转到 /app/space
   - [ ] 旧链接重定向生效

3. **UI 测试**
   - [ ] 宽度与发布页面一致
   - [ ] 颜色和字体符合设计
   - [ ] 间距严格遵循规范
   - [ ] 交互状态（hover、active）正确
   - [ ] 整体扁平精密

4. **兼容性测试**
   - [ ] 各浏览器显示正常
   - [ ] 不同屏幕尺寸适配
   - [ ] 无控制台错误
   - [ ] 性能无明显影响

## 后续工作

1. 实现其他设置页面：
   - 高级设置

2. 可能的增强：
   - 添加设置搜索功能
   - 实现设置项的分组展开/收起
   - 添加设置修改历史记录
   - 实现设置导入/导出功能

## 总结

此次迁移成功将 WebAuthn 注册功能整合到统一的设置中心，提升了：

- ✅ UI 的一致性和专业性（与发布页面统一）
- ✅ 设计的扁平精密性（移除冗余装饰）
- ✅ 结构的严谨性（严格遵循设计规范）
- ✅ 功能的可发现性
- ✅ 代码的可维护性
- ✅ 未来的可扩展性
- ✅ 向后兼容性

同时保持了原有功能的完整性和稳定性。
